---
source: crates/sapling_transformer/tests/test_utils.rs
expression: benchmark.tsx
---
# Input
```tsx
import { Mutate, State } from "@idealjs/sapling";

import For from "./for";

const A = [
  "pretty",
  "large",
  "big",
  "small",
  "tall",
  "short",
  "long",
  "handsome",
  "plain",
  "quaint",
  "clean",
  "elegant",
  "easy",
  "angry",
  "crazy",
  "helpful",
  "mushy",
  "odd",
  "unsightly",
  "adorable",
  "important",
  "inexpensive",
  "cheap",
  "expensive",
  "fancy",
];

const C = [
  "red",
  "yellow",
  "blue",
  "green",
  "pink",
  "brown",
  "purple",
  "brown",
  "white",
  "black",
  "orange",
];

const N = [
  "table",
  "chair",
  "house",
  "bbq",
  "desk",
  "car",
  "pony",
  "cookie",
  "sandwich",
  "burger",
  "pizza",
  "mouse",
  "keyboard",
];

const random = (max: number) => Math.round(Math.random() * 1000) % max;

let nextId = 1;

function assignData(data: { id: number; label: string }[], offset = 0) {
  const count = data.length;
  for (let i = offset; i < count; i++) {
    data[i] = {
      id: nextId++,
      label: `${A[random(A.length)]} ${C[random(C.length)]} ${N[random(N.length)]}`,
    };
  }
  return data;
}

interface IData {
  id: number;
  label: string;
}

class Row {
  @State accessor props: {
    item: IData;
    selected: number;
    onSelect: (id: number) => void;
    onRemove: (id: number) => void;
  };
  constructor(p: {
    item: IData;
    selected: number;
    onSelect: (id: number) => void;
    onRemove: (id: number) => void;
  }) {
    this.props = p;
  }
  render() {
    const { item, selected, onSelect, onRemove } = this.props;
    const isSelected = selected === item.id;
    return (
      <tr className={isSelected ? "danger" : ""}>
        <td className="col-md-1">{item.id}</td>
        <td className="col-md-4">
          <a onClick={() => onSelect(item.id)}>{item.label}</a>
        </td>
        <td className="col-md-1">
          <a onClick={() => onRemove(item.id)}>
            <span
              className="glyphicon glyphicon-remove"
              aria-hidden="true"
            ></span>
          </a>
        </td>
        <td className="col-md-6"></td>
      </tr>
    );
  }
}

class App {
  @State accessor data: IData[] = [];
  @State accessor selected: number = 0;

  @Mutate
  run() {
    this.data = new Array(1000);
    assignData(this.data);
    this.selected = 0;
  }

  @Mutate
  runLots() {
    this.data = new Array(10000);
    assignData(this.data);
    this.selected = 0;
  }

  @Mutate
  add() {
    const offset = this.data.length;
    this.data.length += 1000;
    assignData(this.data, offset);
    this.selected = 0;
  }

  @Mutate
  update() {
    for (let i = 0; i < this.data.length; i += 10) {
      const r = this.data[i];
      this.data[i] = { id: r.id, label: r.label + " !!!" };
    }
  }

  @Mutate
  remove(id: number) {
    const idx = this.data.findIndex((d) => d.id === id);
    if (idx >= 0) this.data.splice(idx, 1);
  }

  @Mutate
  select(id: number) {
    this.selected = id;
  }

  @Mutate
  clear() {
    this.data = [];
    this.selected = 0;
  }

  @Mutate
  swapRows() {
    if (this.data.length > 998) {
      const tmp = this.data[1];
      this.data[1] = this.data[998];
      this.data[998] = tmp;
    }
  }

  render() {
    const { data, selected } = this;
    return (
      <div className="container">
        <div className="jumbotron">
          <div className="row">
            <div className="col-md-6">
              <h1>Sapling</h1>
            </div>
            <div className="col-md-6">
              <div className="row">
                <div className="col-sm-6 smallpad">
                  <button
                    type="button"
                    className="btn btn-primary btn-block"
                    id="run"
                    onClick={() => this.run()}
                  >
                    Create 1,000 rows
                  </button>
                </div>
                <div className="col-sm-6 smallpad">
                  <button
                    type="button"
                    className="btn btn-primary btn-block"
                    id="runlots"
                    onClick={() => this.runLots()}
                  >
                    Create 10,000 rows
                  </button>
                </div>
                <div className="col-sm-6 smallpad">
                  <button
                    type="button"
                    className="btn btn-primary btn-block"
                    id="add"
                    onClick={() => this.add()}
                  >
                    Append 1,000 rows
                  </button>
                </div>
                <div className="col-sm-6 smallpad">
                  <button
                    type="button"
                    className="btn btn-primary btn-block"
                    id="update"
                    onClick={() => this.update()}
                  >
                    Update every 10th row
                  </button>
                </div>
                <div className="col-sm-6 smallpad">
                  <button
                    type="button"
                    className="btn btn-primary btn-block"
                    id="clear"
                    onClick={() => this.clear()}
                  >
                    Clear
                  </button>
                </div>
                <div className="col-sm-6 smallpad">
                  <button
                    type="button"
                    className="btn btn-primary btn-block"
                    id="swaprows"
                    onClick={() => this.swapRows()}
                  >
                    Swap Rows
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <table className="table table-hover table-striped test-data">
          <tbody>
            <For each={data} fallback={<tr />}>
              {(item) => (
                <Row
                  item={item}
                  selected={selected}
                  onSelect={(id) => this.select(id)}
                  onRemove={(id) => this.remove(id)}
                />
              )}
            </For>
          </tbody>
        </table>
        <span
          className="preloadicon glyphicon glyphicon-remove"
          aria-hidden="true"
        ></span>
      </div>
    );
  }
}

export default App;

```

# Transformations
```tsx
import { Mutate, State } from "@idealjs/sapling";

import For from "./for";

const A = [
  "pretty",
  "large",
  "big",
  "small",
  "tall",
  "short",
  "long",
  "handsome",
  "plain",
  "quaint",
  "clean",
  "elegant",
  "easy",
  "angry",
  "crazy",
  "helpful",
  "mushy",
  "odd",
  "unsightly",
  "adorable",
  "important",
  "inexpensive",
  "cheap",
  "expensive",
  "fancy",
];

const C = [
  "red",
  "yellow",
  "blue",
  "green",
  "pink",
  "brown",
  "purple",
  "brown",
  "white",
  "black",
  "orange",
];

const N = [
  "table",
  "chair",
  "house",
  "bbq",
  "desk",
  "car",
  "pony",
  "cookie",
  "sandwich",
  "burger",
  "pizza",
  "mouse",
  "keyboard",
];

const random = (max: number) => Math.round(Math.random() * 1000) % max;

let nextId = 1;

function assignData(data: { id: number; label: string }[], offset = 0) {
  const count = data.length;
  for (let i = offset; i < count; i++) {
    data[i] = {
      id: nextId++,
      label: `${A[random(A.length)]} ${C[random(C.length)]} ${N[random(N.length)]}`,
    };
  }
  return data;
}

interface IData {
  id: number;
  label: string;
}

class Row {
  @State accessor props: {
    item: IData;
    selected: number;
    onSelect: (id: number) => void;
    onRemove: (id: number) => void;
  };
  constructor(p: {
    item: IData;
    selected: number;
    onSelect: (id: number) => void;
    onRemove: (id: number) => void;
  }) {
    this.props = p;
  }
  render() {
    const { item, selected, onSelect, onRemove } = this.props;
    const isSelected = selected === item.id;
    return _$createJsxTagElement(() => {
      let _el$ = _$createElement("tr");
      _$effect(
        () => {
          _$setProp(_el$, "className", isSelected ? "danger" : "");
        },
        () => {
          return [isSelected ? "danger" : ""];
        },
      );
      let _el$1 = _$createElement("td");
      _$setProp(_el$1, "className", "col-md-1");
      _$effect(
        () => {
          _$insert(_el$1, item.id);
        },
        () => {
          return [item.id];
        },
      );
      _$insertNode(_el$, _el$1);
      let _el$2 = _$createElement("td");
      _$setProp(_el$2, "className", "col-md-4");
      let _el$3 = _$createElement("a");
      _$setProp(_el$3, "onClick", () => onSelect(item.id));
      _$effect(
        () => {
          _$insert(_el$3, item.label);
        },
        () => {
          return [item.label];
        },
      );
      _$insertNode(_el$2, _el$3);
      _$insertNode(_el$, _el$2);
      let _el$4 = _$createElement("td");
      _$setProp(_el$4, "className", "col-md-1");
      let _el$5 = _$createElement("a");
      _$setProp(_el$5, "onClick", () => onRemove(item.id));
      let _el$6 = _$createElement("span");
      _$setProp(_el$6, "className", "glyphicon glyphicon-remove");
      _$setProp(_el$6, "aria-hidden", "true");
      _$insertNode(_el$5, _el$6);
      _$insertNode(_el$4, _el$5);
      _$insertNode(_el$, _el$4);
      let _el$7 = _$createElement("td");
      _$setProp(_el$7, "className", "col-md-6");
      _$insertNode(_el$, _el$7);
      return _el$;
    });
  }
}

class App {
  @State accessor data: IData[] = [];
  @State accessor selected: number = 0;

  @Mutate
  run() {
    this.data = new Array(1000);
    assignData(this.data);
    this.selected = 0;
  }

  @Mutate
  runLots() {
    this.data = new Array(10000);
    assignData(this.data);
    this.selected = 0;
  }

  @Mutate
  add() {
    const offset = this.data.length;
    this.data.length += 1000;
    assignData(this.data, offset);
    this.selected = 0;
  }

  @Mutate
  update() {
    for (let i = 0; i < this.data.length; i += 10) {
      const r = this.data[i];
      this.data[i] = { id: r.id, label: r.label + " !!!" };
    }
  }

  @Mutate
  remove(id: number) {
    const idx = this.data.findIndex((d) => d.id === id);
    if (idx >= 0) this.data.splice(idx, 1);
  }

  @Mutate
  select(id: number) {
    this.selected = id;
  }

  @Mutate
  clear() {
    this.data = [];
    this.selected = 0;
  }

  @Mutate
  swapRows() {
    if (this.data.length > 998) {
      const tmp = this.data[1];
      this.data[1] = this.data[998];
      this.data[998] = tmp;
    }
  }

  render() {
    const { data, selected } = this;
    return _$createJsxTagElement(() => {
      let _el$ = _$createElement("div");
      _$setProp(_el$, "className", "container");
      let _el$1 = _$createElement("div");
      _$setProp(_el$1, "className", "jumbotron");
      let _el$2 = _$createElement("div");
      _$setProp(_el$2, "className", "row");
      let _el$3 = _$createElement("div");
      _$setProp(_el$3, "className", "col-md-6");
      let _el$4 = _$createElement("h1");
      _$insertNode(_el$4, _$createTextNode("Sapling"));
      _$insertNode(_el$3, _el$4);
      _$insertNode(_el$2, _el$3);
      let _el$5 = _$createElement("div");
      _$setProp(_el$5, "className", "col-md-6");
      let _el$6 = _$createElement("div");
      _$setProp(_el$6, "className", "row");
      let _el$7 = _$createElement("div");
      _$setProp(_el$7, "className", "col-sm-6 smallpad");
      let _el$8 = _$createElement("button");
      _$setProp(_el$8, "type", "button");
      _$setProp(_el$8, "className", "btn btn-primary btn-block");
      _$setProp(_el$8, "id", "run");
      _$setProp(_el$8, "onClick", () => this.run());
      _$insertNode(_el$8, _$createTextNode("Create 1,000 rows"));
      _$insertNode(_el$7, _el$8);
      _$insertNode(_el$6, _el$7);
      let _el$9 = _$createElement("div");
      _$setProp(_el$9, "className", "col-sm-6 smallpad");
      let _el$10 = _$createElement("button");
      _$setProp(_el$10, "type", "button");
      _$setProp(_el$10, "className", "btn btn-primary btn-block");
      _$setProp(_el$10, "id", "runlots");
      _$setProp(_el$10, "onClick", () => this.runLots());
      _$insertNode(_el$10, _$createTextNode("Create 10,000 rows"));
      _$insertNode(_el$9, _el$10);
      _$insertNode(_el$6, _el$9);
      let _el$11 = _$createElement("div");
      _$setProp(_el$11, "className", "col-sm-6 smallpad");
      let _el$12 = _$createElement("button");
      _$setProp(_el$12, "type", "button");
      _$setProp(_el$12, "className", "btn btn-primary btn-block");
      _$setProp(_el$12, "id", "add");
      _$setProp(_el$12, "onClick", () => this.add());
      _$insertNode(_el$12, _$createTextNode("Append 1,000 rows"));
      _$insertNode(_el$11, _el$12);
      _$insertNode(_el$6, _el$11);
      let _el$13 = _$createElement("div");
      _$setProp(_el$13, "className", "col-sm-6 smallpad");
      let _el$14 = _$createElement("button");
      _$setProp(_el$14, "type", "button");
      _$setProp(_el$14, "className", "btn btn-primary btn-block");
      _$setProp(_el$14, "id", "update");
      _$setProp(_el$14, "onClick", () => this.update());
      _$insertNode(_el$14, _$createTextNode("Update every 10th row"));
      _$insertNode(_el$13, _el$14);
      _$insertNode(_el$6, _el$13);
      let _el$15 = _$createElement("div");
      _$setProp(_el$15, "className", "col-sm-6 smallpad");
      let _el$16 = _$createElement("button");
      _$setProp(_el$16, "type", "button");
      _$setProp(_el$16, "className", "btn btn-primary btn-block");
      _$setProp(_el$16, "id", "clear");
      _$setProp(_el$16, "onClick", () => this.clear());
      _$insertNode(_el$16, _$createTextNode("Clear"));
      _$insertNode(_el$15, _el$16);
      _$insertNode(_el$6, _el$15);
      let _el$17 = _$createElement("div");
      _$setProp(_el$17, "className", "col-sm-6 smallpad");
      let _el$18 = _$createElement("button");
      _$setProp(_el$18, "type", "button");
      _$setProp(_el$18, "className", "btn btn-primary btn-block");
      _$setProp(_el$18, "id", "swaprows");
      _$setProp(_el$18, "onClick", () => this.swapRows());
      _$insertNode(_el$18, _$createTextNode("Swap Rows"));
      _$insertNode(_el$17, _el$18);
      _$insertNode(_el$6, _el$17);
      _$insertNode(_el$5, _el$6);
      _$insertNode(_el$2, _el$5);
      _$insertNode(_el$1, _el$2);
      _$insertNode(_el$, _el$1);
      let _el$19 = _$createElement("table");
      _$setProp(
        _el$19,
        "className",
        "table table-hover table-striped test-data",
      );
      let _el$20 = _$createElement("tbody");
      let _el$21 = _$createComponent(For, {
        each: data,
        fallback: _$createJsxTagElement(() => {
          let _el$23 = _$createElement("tr");
          return _el$23;
        }),
        children: [
          (item) =>
            _$createJsxTagElement(() => {
              let _el$24 = _$createComponent(Row, {
                item: item,
                selected: selected,
                onSelect: (id) => this.select(id),
                onRemove: (id) => this.remove(id),
              });
              return _el$24;
            }),
        ],
      });
      _$insertNode(_el$20, _el$21);
      _$insertNode(_el$19, _el$20);
      _$insertNode(_el$, _el$19);
      let _el$22 = _$createElement("span");
      _$setProp(_el$22, "className", "preloadicon glyphicon glyphicon-remove");
      _$setProp(_el$22, "aria-hidden", "true");
      _$insertNode(_el$, _el$22);
      return _el$;
    });
  }
}

export default App;

```
